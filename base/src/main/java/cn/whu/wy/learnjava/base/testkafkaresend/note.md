本质在于主机房的offset与备机房不一样，导致主机房的断点不能在备机房使用。

## 无限缓存方案 Main1.java

- 不匹配的消息全部放入魂村，后续命中缓存后移除。
- 优势：只需消费一次
- 劣势：极端场景下，缓存大小接近于消息量，内存吃不消

以下是测试不同数据量下，缓存的最大容量：

20万

```
首次命中:145033
缓存命中:54967
合计命中:200000
缓存最大容量:4953, 缓存比例:2%, 耗时:1s

首次命中:128644
缓存命中:71356
合计命中:200000
缓存最大容量:24625, 缓存比例:12%, 耗时:1s
```

100万

```
首次命中:508155
缓存命中:491845
合计命中:1000000
缓存最大容量:297375, 缓存比例:29%, 耗时:5s

首次命中:556697
缓存命中:443303
合计命中:1000000
缓存最大容量:129634, 缓存比例:12%, 耗时:7s
```

1000万

```
首次命中:5009732
缓存命中:4990268
合计命中:10000000
缓存最大容量:2186414, 缓存比例:21%, 耗时:75s

首次命中:5016339
缓存命中:4983661
合计命中:10000000
缓存最大容量:3166545, 缓存比例:31%, 耗时:68s

缓存最大容量:4591199, 缓存比例:45%, 耗时:41s
缓存最大容量:407639, 缓存比例:4%, 耗时:80s
```

## 有限缓存方案 Main2.java

需要多次poll。 以下测试缓存大小与poll次数的关系，力求找到平衡点。

bitchSize=1万，两方写，平均情况，2万的缓存能覆盖全。

| 数据量   | 缓存大小 | poll次数   | 处理时间(s) |
|-------|------|----------|---------|
| 100万  | 1万   | 631200 + | 90+     |
| 100万  | 2万   | +++      | +++     |
| 100万  | 5万   | +++      | +++     |
| 100万  | 10万  | +++      | +++     |
| 1000万 | 1万   |          |         |
| 1000万 | 2万   |          |         |
| 1000万 | 5万   |          |         |
| 1000万 | 10万  |          |         |






